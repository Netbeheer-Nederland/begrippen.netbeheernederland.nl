<!--                      -->
<!-- GISCUS (opmerkingen) -->
<!--                      -->

<div id="giscus-container">
    <p id="load-giscus-comments">
        <button type="button" name="button" class="btn fs-3" onclick="loadGiscusComments()">
            Toon opmerkingen
        </button>
    </p>
</div>

<script>
    function loadGiscusComments() {
        let header = '<h2 class="text-delta">Opmerkingen</h2>';
        let script = document.createElement('script');
        script.src = "https://giscus.app/client.js";
        script.async = true;
        script.crossOrigin = "anonymous";

        script.setAttribute("data-repo", "netbeheer-nederland/energiesysteembeheer");
        script.setAttribute("data-repo-id", "R_kgDOQbdEvg");
        script.setAttribute("data-category", "Announcements");
        script.setAttribute("data-category-id", "DIC_kwDOQbdEvs4Cy4mX");
        script.setAttribute("data-mapping", "pathname");
        script.setAttribute("data-strict", "1");
        script.setAttribute("data-reactions-enabled", "0");
        script.setAttribute("data-emit-metadata", "0");
        script.setAttribute("data-input-position", "bottom");
        script.setAttribute("data-theme", "light");
        script.setAttribute("data-lang", "nl");
        script.setAttribute("data-loading", "lazy");

        document.getElementById("giscus-container").replaceChild(script, document.getElementById('load-giscus-comments'));
    }
</script>

<!--                -->
<!-- NAVIGATIEMODUS -->
<!--                -->

<!-- DE WISSELKNOP (standaard verborgen) -->
<span id="skos-toggle-container" class="fw-500"> - <a href="#" id="btn-toggle-nav">alfabatisch weergeven</a></span>

<!-- DE ALFABETISCHE LIJST (standaard verborgen) -->
<div id="skos-az-list" style="display: none;">
  <ul class="nav-list">
    <!-- LET OP: Zorg dat 'site.doc' klopt met _config.yml -->
    {% assign items = site.doc | sort: 'title' %}
    
    {% for page in items %}
        <li class="nav-list-item">
          <a href="{{ page.url | relative_url }}" class="nav-list-link">{{ page.title }}</a>
        </li>
    {% endfor %}
  </ul>
</div>

<!-- HET SCRIPT (zet alles op de juiste plek en regelt de klik) -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    /* Selecteer elementen */
    var sidebar = document.querySelector('.site-nav');
    var originalList = document.querySelector('.site-nav > .nav-category + .nav-list');
    var toggleContainer = document.getElementById('skos-toggle-container');
    var azList = document.getElementById('skos-az-list');
    var btn = document.getElementById('btn-toggle-nav');

    /* Functie om de weergave te bepalen (en op te slaan) */
    function setNavMode(mode) {
      if (mode === 'az') {
        /* Weergave: A-Z */
        originalList.style.display = 'none';
        azList.style.display = 'block';
        btn.textContent = "hiërarchisch weergeven";
        localStorage.setItem('skos-nav-pref', 'az');
      } else {
        /* Weergave: hiërarchie (boom) */
        originalList.style.display = 'block';
        azList.style.display = 'none';
        btn.textContent = "alfabetisch weergeven"; 
        localStorage.setItem('skos-nav-pref', 'tree');
      }
    }

    if (sidebar && originalList && toggleContainer && azList) {
      
      /* --- PLAATSING LOGICA --- */
      const navCategory = document.querySelector('.nav-category');
      navCategory.appendChild(toggleContainer);
      sidebar.insertBefore(azList, originalList);

      originalList.id = "skos-tree-list";

      /* --- GEHEUGEN CHECK --- */
      /* Kijk of er een voorkeur is opgeslagen. Zo niet, standaard 'tree'. */
      var savedPref = localStorage.getItem('skos-nav-pref');
      
      if (savedPref === 'az') {
        setNavMode('az');
      } else {
        setNavMode('tree');
      }

      /* --- KLIK EVENT --- */
      btn.addEventListener('click', function() {
        /* Check huidige status door naar display te kijken */
        if (azList.style.display === 'none') {
          setNavMode('az');
        } else {
          setNavMode('tree');
        }
      });
    }
  });
</script>
